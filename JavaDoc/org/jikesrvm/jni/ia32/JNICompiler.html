<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>JNICompiler (Jikes RVM API)</title>
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="JNICompiler (Jikes RVM API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":9,"i1":9,"i2":9};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/JNICompiler.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../org/jikesrvm/jni/ia32/JNIExceptionDeliverer.html" title="class in org.jikesrvm.jni.ia32"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/jikesrvm/jni/ia32/JNICompiler.html" target="_top">Frames</a></li>
<li><a href="JNICompiler.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.jikesrvm.jni.ia32</div>
<h2 title="Class JNICompiler" class="title">Class JNICompiler</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>org.jikesrvm.jni.ia32.JNICompiler</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public abstract class <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.114">JNICompiler</a>
extends <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></pre>
<div class="block">This class compiles the prolog and epilog for all code that makes
 the transition between Java and Native C for the 2 cases:
 <ul>
 <li>from Java to C:  all user-defined native methods</li>
 <li>C to Java:  all JNI functions in <a href="../../../../org/jikesrvm/jni/JNIFunctions.html" title="class in org.jikesrvm.jni"><code>JNIFunctions</code></a></li>
 </ul>
 When performing the transitions the values in registers and on the stack need
 to be treated with care, but also when transitioning into Java we need to do
 a spin-wait if a GC is underway.

 Transitioning from Java to C then back:
 <ol>
 <li>Set up stack frame and save non-volatile registers</li>
 <li>Move all native method arguments on to stack (NB at this point all non-volatile state is saved)</li>
 <li>Set up jniEnv</li>
 <li>Record the frame pointer of the last Java frame (this) in the jniEnv</li>
 <li>Set up JNI refs, a stack that holds references accessed via JNI</li>
 <li>Call out to convert reference arguments to IDs</li>
 <li>Set processor as being "in native"</li>
 <li>Set up stack frame and registers for transition to C</li>
 <li>Call out to C</li>
 <li>Save result to stack</li>
 <li>Transition back from "in native" to "in Java", take care that the
     Processor isn't "blocked in native", ie other processors have decided to
     start a GC and we're not permitted to execute Java code whilst this
     occurs</li>
 <li>Convert a reference result (currently a JNI ref) into a true reference</li>
 <li>Release JNI refs</li>
 <li>Restore stack and place result in register</li>
 </ol>

 Prologue generation from C to Java:
 <ol>
 <li>Set up stack frame with C arguments in Jikes RVM convention</li>
 <li>Set up extra stack frame entry that records the previous last top Java FP</li>
 <li>Transition from "in native" to "in Java" taking care of blocked (in GC)
       case</li>
 </ol>

 Epilogue generation from Java to C:
 <ol>
 <li>Restore record of the previous last top Java FP in the jniEnv</li>
 <li>Transition from "in Java" to "in native"</li>
 <li>Set up result in registers. NB. JNIFunctions don't return references but
     JNI refs directly, so we don't need to transition these</li>
 </ol></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static <a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#BP_ON_ENTRY_OFFSET">BP_ON_ENTRY_OFFSET</a></span></code>
<div class="block">Location of a saved version of the field JNIEnvironment.basePointerOnEntryToNative</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) static <a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#EBP_SAVE_OFFSET">EBP_SAVE_OFFSET</a></span></code>
<div class="block">Location of non-volatile EBP register when saved to stack</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) static <a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#EBX_SAVE_OFFSET">EBX_SAVE_OFFSET</a></span></code>
<div class="block">Location of non-volatile EBX register when saved to stack</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) static <a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#EDI_SAVE_OFFSET">EDI_SAVE_OFFSET</a></span></code>
<div class="block">Location of non-volatile EDI register when saved to stack</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static <a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#JNI_ENV_OFFSET">JNI_ENV_OFFSET</a></span></code>
<div class="block">Location of an extra copy of the RVMThread.jniEnv when saved to stack</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#jniExternalFunctionsFieldOffset">jniExternalFunctionsFieldOffset</a></span></code>
<div class="block">Offset of external functions field in JNIEnvironment</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#SAVED_GPRS_FOR_JNI">SAVED_GPRS_FOR_JNI</a></span></code>
<div class="block">The following is used in BaselineCompilerImpl to compute offset to first local.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static <a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#SAVED_JAVA_FP_OFFSET">SAVED_JAVA_FP_OFFSET</a></span></code>
<div class="block">Stack frame location for saved JNIEnvironment.JNITopJavaFP that
 will be clobbered by a transition from Java to C.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../org/jikesrvm/jni/ia32/JNIExceptionDeliverer.html" title="class in org.jikesrvm.jni.ia32">JNIExceptionDeliverer</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#unused">unused</a></span></code>
<div class="block">Dummy field to force compilation of the exception deliverer</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#JNICompiler--">JNICompiler</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>static <a href="../../../../org/jikesrvm/compilers/common/CompiledMethod.html" title="class in org.jikesrvm.compilers.common">CompiledMethod</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#compile-org.jikesrvm.classloader.NativeMethod-">compile</a></span>(<a href="../../../../org/jikesrvm/classloader/NativeMethod.html" title="class in org.jikesrvm.classloader">NativeMethod</a>&nbsp;method)</code>
<div class="block">Compiles a method to handle the Java to C transition and back
 Transitioning from Java to C then back:
 
 Set up stack frame and save non-volatile registers
 Set up jniEnv - set up a register to hold JNIEnv and store
     the Processor in the JNIEnv for easy access
 Move all native method arguments on to stack (NB at this point all
     non-volatile state is saved)
 Record the frame pointer of the last Java frame (this) in the jniEnv
 Call out to convert reference arguments to IDs
 Set processor as being "in native"
 Set up stack frame and registers for transition to C
 Call out to C
 Save result to stack
 Transition back from "in native" to "in Java", take care that the
     Processor isn't "blocked in native", ie other processors have decided to
     start a GC and we're not permitted to execute Java code whilst this
     occurs
 Convert a reference result (currently a JNI ref) into a true reference
 Release JNI refs
 Restore stack and place result in register
 </div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#generateEpilogForJNIMethod-org.jikesrvm.compilers.common.assembler.ia32.Assembler-org.jikesrvm.classloader.RVMMethod-">generateEpilogForJNIMethod</a></span>(<a href="../../../../org/jikesrvm/compilers/common/assembler/ia32/Assembler.html" title="class in org.jikesrvm.compilers.common.assembler.ia32">Assembler</a>&nbsp;asm,
                          <a href="../../../../org/jikesrvm/classloader/RVMMethod.html" title="class in org.jikesrvm.classloader">RVMMethod</a>&nbsp;method)</code>
<div class="block">Handles the C to Java transition:  JNI methods in JNIFunctions.java.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/jikesrvm/jni/ia32/JNICompiler.html#generateGlueCodeForJNIMethod-org.jikesrvm.compilers.common.assembler.ia32.Assembler-org.jikesrvm.classloader.NormalMethod-int-">generateGlueCodeForJNIMethod</a></span>(<a href="../../../../org/jikesrvm/compilers/common/assembler/ia32/Assembler.html" title="class in org.jikesrvm.compilers.common.assembler.ia32">Assembler</a>&nbsp;asm,
                            <a href="../../../../org/jikesrvm/classloader/NormalMethod.html" title="class in org.jikesrvm.classloader">NormalMethod</a>&nbsp;method,
                            int&nbsp;methodID)</code>
<div class="block">Handles the C to Java transition:  JNI methods in JNIFunctions.java.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="unused">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>unused</h4>
<pre>private&nbsp;<a href="../../../../org/jikesrvm/jni/ia32/JNIExceptionDeliverer.html" title="class in org.jikesrvm.jni.ia32">JNIExceptionDeliverer</a> <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.117">unused</a></pre>
<div class="block">Dummy field to force compilation of the exception deliverer</div>
</li>
</ul>
<a name="jniExternalFunctionsFieldOffset">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>jniExternalFunctionsFieldOffset</h4>
<pre>private static final&nbsp;int <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.120">jniExternalFunctionsFieldOffset</a></pre>
<div class="block">Offset of external functions field in JNIEnvironment</div>
</li>
</ul>
<a name="EDI_SAVE_OFFSET">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>EDI_SAVE_OFFSET</h4>
<pre>static final&nbsp;<a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a> <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.126">EDI_SAVE_OFFSET</a></pre>
<div class="block">Location of non-volatile EDI register when saved to stack</div>
</li>
</ul>
<a name="EBX_SAVE_OFFSET">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>EBX_SAVE_OFFSET</h4>
<pre>static final&nbsp;<a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a> <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.128">EBX_SAVE_OFFSET</a></pre>
<div class="block">Location of non-volatile EBX register when saved to stack</div>
</li>
</ul>
<a name="EBP_SAVE_OFFSET">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>EBP_SAVE_OFFSET</h4>
<pre>static final&nbsp;<a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a> <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.130">EBP_SAVE_OFFSET</a></pre>
<div class="block">Location of non-volatile EBP register when saved to stack</div>
</li>
</ul>
<a name="JNI_ENV_OFFSET">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>JNI_ENV_OFFSET</h4>
<pre>private static final&nbsp;<a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a> <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.132">JNI_ENV_OFFSET</a></pre>
<div class="block">Location of an extra copy of the RVMThread.jniEnv when saved to stack</div>
</li>
</ul>
<a name="BP_ON_ENTRY_OFFSET">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BP_ON_ENTRY_OFFSET</h4>
<pre>private static final&nbsp;<a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a> <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.134">BP_ON_ENTRY_OFFSET</a></pre>
<div class="block">Location of a saved version of the field JNIEnvironment.basePointerOnEntryToNative</div>
</li>
</ul>
<a name="SAVED_JAVA_FP_OFFSET">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>SAVED_JAVA_FP_OFFSET</h4>
<pre>private static final&nbsp;<a href="../../../../org/vmmagic/unboxed/Offset.html" title="class in org.vmmagic.unboxed">Offset</a> <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.142">SAVED_JAVA_FP_OFFSET</a></pre>
<div class="block">Stack frame location for saved JNIEnvironment.JNITopJavaFP that
 will be clobbered by a transition from Java to C.  Only used in
 the prologue &amp; epilogue for JNIFunctions.</div>
</li>
</ul>
<a name="SAVED_GPRS_FOR_JNI">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>SAVED_GPRS_FOR_JNI</h4>
<pre>public static final&nbsp;int <a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.148">SAVED_GPRS_FOR_JNI</a></pre>
<div class="block">The following is used in BaselineCompilerImpl to compute offset to first local.
 Number of non-volatile GPRs and FPRs and then 1 slot for the SAVED_JAVA_FP.</div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="JNICompiler--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>JNICompiler</h4>
<pre>public&nbsp;<a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.114">JNICompiler</a>()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="compile-org.jikesrvm.classloader.NativeMethod-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>compile</h4>
<pre>public static&nbsp;<a href="../../../../org/jikesrvm/compilers/common/CompiledMethod.html" title="class in org.jikesrvm.compilers.common">CompiledMethod</a>&nbsp;<a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.177">compile</a>(<a href="../../../../org/jikesrvm/classloader/NativeMethod.html" title="class in org.jikesrvm.classloader">NativeMethod</a>&nbsp;method)</pre>
<div class="block">Compiles a method to handle the Java to C transition and back
 Transitioning from Java to C then back:
 <ol>
 <li>Set up stack frame and save non-volatile registers<li>
 <li>Set up jniEnv - set up a register to hold JNIEnv and store
     the Processor in the JNIEnv for easy access</li>
 <li>Move all native method arguments on to stack (NB at this point all
     non-volatile state is saved)</li>
 <li>Record the frame pointer of the last Java frame (this) in the jniEnv</li>
 <li>Call out to convert reference arguments to IDs</li>
 <li>Set processor as being "in native"</li>
 <li>Set up stack frame and registers for transition to C</li>
 <li>Call out to C</li>
 <li>Save result to stack</li>
 <li>Transition back from "in native" to "in Java", take care that the
     Processor isn't "blocked in native", ie other processors have decided to
     start a GC and we're not permitted to execute Java code whilst this
     occurs</li>
 <li>Convert a reference result (currently a JNI ref) into a true reference</li>
 <li>Release JNI refs</li>
 <li>Restore stack and place result in register</li>
 </ol></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>method</code> - the method to compile</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the compiled method (always a <a href="../../../../org/jikesrvm/jni/JNICompiledMethod.html" title="class in org.jikesrvm.jni"><code>JNICompiledMethod</code></a>)</dd>
</dl>
</li>
</ul>
<a name="generateGlueCodeForJNIMethod-org.jikesrvm.compilers.common.assembler.ia32.Assembler-org.jikesrvm.classloader.NormalMethod-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>generateGlueCodeForJNIMethod</h4>
<pre>public static&nbsp;void&nbsp;<a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.716">generateGlueCodeForJNIMethod</a>(<a href="../../../../org/jikesrvm/compilers/common/assembler/ia32/Assembler.html" title="class in org.jikesrvm.compilers.common.assembler.ia32">Assembler</a>&nbsp;asm,
                                                <a href="../../../../org/jikesrvm/classloader/NormalMethod.html" title="class in org.jikesrvm.classloader">NormalMethod</a>&nbsp;method,
                                                int&nbsp;methodID)</pre>
<div class="block">Handles the C to Java transition:  JNI methods in JNIFunctions.java.
 Creates a prologue for the baseline compiler.
 <pre>
 NOTE:
   -We need THREAD_REGISTER to access Java environment; we can get it from
    the JNIEnv* (which is an interior pointer to the JNIEnvironment)
   -Unlike the powerPC scheme which has a special prolog preceding
    the normal Java prolog, the Intel scheme replaces the Java prolog
    completely with the special prolog

            Stack on entry            Stack at end of prolog after call
             high memory                       high memory
            |            |                   |            |
    EBP -&gt;  |saved FP    |                   |saved FP    |
            |  ...       |                   |  ...       |
            |            |                   |            |
            |arg n-1     |                   |arg n-1     |
 native     |  ...       |                   |  ...       |
 caller     |arg 0       | JNIEnv*           |arg 0       | JNIEnvironment
    ESP -&gt;  |return addr |                   |return addr |
            |            |           EBP -&gt;  |saved FP    | outer most native frame pointer
            |            |                   |methodID    | normal MethodID for JNI function
            |            |                   |saved JavaFP| offset to preceeding java frame
            |            |                   |saved nonvol| to be used for nonvolatile storage
            |            |                   |  ...       |   including ebp on entry
            |            |                   |arg 0       | copied in reverse order (JNIEnvironment)
            |            |                   |  ...       |
            |            |           ESP -&gt;  |arg n-1     |
            |            |                   |            | normally compiled Java code continue
            |            |                   |            |
            |            |                   |            |
            |            |                   |            |
             low memory                        low memory
 </pre></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>asm</code> - the assembler to use</dd>
<dd><code>method</code> - the method that's being compiled (i.e. the method which is a bridge
  from native).</dd>
<dd><code>methodID</code> - the id of the compiled method</dd>
</dl>
</li>
</ul>
<a name="generateEpilogForJNIMethod-org.jikesrvm.compilers.common.assembler.ia32.Assembler-org.jikesrvm.classloader.RVMMethod-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>generateEpilogForJNIMethod</h4>
<pre>public static&nbsp;void&nbsp;<a href="../../../../src-html/org/jikesrvm/jni/ia32/JNICompiler.html#line.977">generateEpilogForJNIMethod</a>(<a href="../../../../org/jikesrvm/compilers/common/assembler/ia32/Assembler.html" title="class in org.jikesrvm.compilers.common.assembler.ia32">Assembler</a>&nbsp;asm,
                                              <a href="../../../../org/jikesrvm/classloader/RVMMethod.html" title="class in org.jikesrvm.classloader">RVMMethod</a>&nbsp;method)</pre>
<div class="block">Handles the C to Java transition:  JNI methods in JNIFunctions.java.
 Creates an epilogue for the baseline compiler.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>asm</code> - the assembler to use</dd>
<dd><code>method</code> - the method that's being compiled</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/JNICompiler.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../org/jikesrvm/jni/ia32/JNIExceptionDeliverer.html" title="class in org.jikesrvm.jni.ia32"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/jikesrvm/jni/ia32/JNICompiler.html" target="_top">Frames</a></li>
<li><a href="JNICompiler.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
