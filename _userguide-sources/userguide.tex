\ifdefined\HCode
  \newcommand\setNextFileName[1]{%
  \NextFile{#1}%
  }%
  \else
  \newcommand\setNextFileName[1]{}%
\fi

\documentclass[a4paper]{book}
% TODO Separate variants for letter paper and a4 paper to support printing without hassle?
\usepackage[iso,english]{isodate} % Use ISO date formatting to prevent confusion between American date formats (mm-dd-yy) and those used by most of the rest of the world (dd-mm-yy)
% TODO We could use \usepackage[iso]{datetime2} but datetime2 is quite new right now (May 2015) and possibly not available via distributions.
\usepackage[usenames,dvipsnames]{xcolor} % for colored star on the Magic page
\usepackage{amssymb} % for \bigstar on the Magic page
\usepackage{hyperref} % for links
\usepackage{listings} % for code listings and command lines
\usepackage{graphicx} % for images
\usepackage[htt]{hyphenat} % For words that contain underscores (e.g. command line options)
\usepackage{spverbatim} % for spverbatim environment which breaks lines and \spverb macro
\usepackage{float} % for strong placement options for floats like H
\usepackage{wasysym} % for smiley on adding new gc page
\usepackage{textcomp} % for \textrightarrow
\usepackage{longtable} % for MMTk harness option table
\usepackage[utf8]{inputenc}
\title{Jikes RVM User Guide}
\author{Jikes RVM Contributors and Core Team}
\lstset{breaklines=true,breakatwhitespace=false,frame=single} % Allow linebreaks anywhere and surround the listing with a frame consisting of a single line

% Disable paragraph indenting
\setlength{\parindent}{0in}

\begin{document}
\maketitle

% TODO When done with everything, make another pass to make sure everything looks ok in HTML and PDF
% TODO We've got several different styles for command lines. A a more consistent styling would be useful. For example, with a custom style or environment. It would also be necessary to edit the listing contents to move from "$", "%" or nothing as a prefix to something consistent.

The User Guide provides Jikes\textsuperscript{TM} RVM information that is not typically covered in \href{http://www.jikesrvm.org/Resources/Publications/}{published papers}. For high-level overviews, algorithms, and structures, you will find the published papers to be the best starting place. The User Guide supplements these Jikes RVM papers, focusing on implementation details of how to build, run, and add functionality to the system.

You may find sections of the User Guide missing, incomplete or otherwise confusing. We intend this document to live as a continual work-in-progress, hopefully growing and maturing as community members edit and add to the guide. Please accept this invitation to contribute.

Please send feedback, bug fixes, and text contributions to the \href{http://www.jikesrvm.org/MailingLists/}{core mailing list} or open a pull request on \href{https://github.com/JikesRVM/jikesrvm.github.io/}{GitHub}. Constructive criticism will be cheerfully accepted.

\begin{itemize}
  \item \hyperref[cha:careandfeeding]{Care and Feeding}: The guide to practical aspects of building, testing, debugging and evaluating Jikes RVM.
  \item \hyperref[cha:architecture]{Architecture}: The guide to the major architectural decisions of Jikes RVM.
  \item \hyperref[cha:mmtktutorial]{MMTk Tutorial}: A simple tutorial to building a collector with MMTk.
\end{itemize}

\chapter{Care and Feeding}
\label{cha:careandfeeding}

This section describes the practical aspects of getting started using and modifying Jikes RVM. The \hyperref[sec:quickstartguide]{Quick Start Guide} gives a 10 second overview on how to get started while the following sections give more detailed instructions.

\input{BuildingJikesRVM}

\input{BuildingPatchedVersions}

\input{CrossPlatformBuilding}

\input{PrimordialClassList}

\input{UsingBuildit}

\input{ConfiguringJikesRVM}

\input{DebuggingJikesRVM}

\input{GDBStackWalking}

\input{ExperimentalGuidelines}

\input{GetTheSource}

\input{ModifyingJikesRVM}

\input{AddingANewGC}

\input{CodingConventions}

\input{CodingStyle}

\input{CompilerDNA}

\input{EditingJikesRVMInAnIDE}

\input{ProfilingApplicationsWithJikesRVM}

\input{QuickStartGuide}

\input{RunningJikesRVM}

\input{TestingJikesRVM}

\input{ExternalTestResources}

\input{TestRunDescriptions}

\input{TheMMTkTestHarness}

\chapter{Architecture}
\label{cha:architecture}

This section describes the architecture of Jikes RVM. The RVM can be divided into the following components:

% TODO links
\begin{itemize}
  \item Core Runtime Services: (thread scheduler, class loader, library support, verifier, etc.) This element is responsible for managing all the underlying data structures required to execute applications and interfacing with libraries.
  \item Magic: The mechanisms used by Jikes RVM to support low-level systems programming in Java.
  \item Compilers: (baseline, optimizing, JNI) This component is responsible for generating executable code from bytecodes.
  \item Memory managers: This component is responsible for the allocation and collection of objects during the execution of an application.
  \item Adaptive Optimization System: This component is responsible for profiling an executing application and judiciously using the optimizing compiler to improve its performance.
\end{itemize}

\input{AdaptiveOptimization}

\input{AOSController}

\input{Cost-Benefit-Model}

\input{JikesRVMsCompilers}

\input{LifecycleOfACompiledMethod}

\input{LoggingAndDebugging}

\input{ThreadingAndYielding}

\input{Compilers}

\input{BaselineCompiler}

\input{OptimizingCompiler}

\input{MethodCompilation}

\input{IR}

\input{BURS}

\input{OptTestHarness}

\input{CoreRuntimeServices}

\input{ObjectModel}

\input{ClassAndCodeManagement}

\input{ThreadManagement}

\input{JNI}

\input{ExceptionManagement}

\input{Bootstrap}

\input{CallingConventions}

\input{VMCallbacks}

\input{Magic}

\input{CompilerIntrinsics}

\input{UnboxedTypes}

\input{RawMemoryAccess}

\input{UninterruptibleCode}

\input{MMTk}

\input{AnatomyOfAGarbageCollector}

\input{MemoryAllocationInJikesRVM}

\input{ScanningObjectsInJikesRVM}

\input{UsingGCSpy}

\chapter{MMTk Tutorial}
\label{cha:mmtktutorial}

% TODO formatting

This tutorial will build up a sophisticated garbage collector from scratch, starting with the empty shell that is the NoGC "collector" in MMTk (collector is a misnomer in this case since NoGC does not collect), and gradually adding functionality.

This tutorial will tell you the mechanics of building a collector in MMTk. It will tell you how but it does not tell you anything about why. The tutorial thus serves two purposes: 1) to give you some insight into the mechanics of MMTk (but not the underlying reasons or design rationale), and 2) show you that the mechanics of building a non-trivial GC in MMTk is not hard, hopefully giving you confidence to start exploring MMTk more deeply.

Please use the latest release to work with the tutorial. If you run into trouble following the instructions, please try again with \spverb+hg tip+. If the problem persists, please \href{http://www.jikesrvm.org/ReportingBugs/}{report this as a bug}.

\begin{enumerate}
\item \hyperref[sec:preliminaries]{Preliminaries}
\item \hyperref[sec:buildingamarksweepcollector]{Building a Mark-sweep Collector}
\item \hyperref[sec:buildingahybridcollector]{Building a Hybrid Copying/Mark-Sweep Collector}
\end{enumerate}

\input{Preliminaries}

\input{BuildingAMarkSweepCollector}

\input{BuildingAHybridCollector}

\end{document}
